var crypto = require('crypto'); 
var rand = require('csprng'); 
var mongoose = require('mongoose'); 
var station = require('config/models');    

//name,number,lat,lon,total,free,bike,date,bonus,callback
exports.updateStation = function(objToDB, callback) {  
	station.findOne({number: objToDB.number},function(err,oStation){
		if(oStation == null){
			console.log("DO NOT EXIST");
			var newStation = new station({
				name	: 	objToDB.name,
				number	: 	objToDB.number,
				lat 	: 	objToDB.lat,
				lon 	: 	objToDB.lon,
				total 	: 	objToDB.total,
				free 	: 	objToDB.free,
				bike 	: 	objToDB.bike,
				date 	: 	objToDB.date,
				bonus	: 	objToDB.bonus
			});
			newStation.save(function (err){
				//console.log(err);
				callback({'response':"Sucessfully Registered"});
			});
		}else{
			if(oStation.date != objToDB.date){
				//objToDB._id = oStation._id;
				var con = {_id : oStation._id};
				station.update(con,objToDB,function(err,ob){
					//console.log(" update of id : "+oStation._id+" dateOld : "+oStation.date+" date now : "+objToDB.date);
				});
			}
		}
	});
}

exports.getAll = function(callback) {  
	station.find({},function(err,stations){
		callback(stations);
	});
}

